{"ast":null,"code":"//create a new session component\nimport React,{useState,useEffect}from\"react\";import axios from\"axios\";import API_BASE_URL from\"../config/api\";import QRCode from\"qrcode.react\";import\"../styles/NewSession.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const NewSession=_ref=>{let{togglePopup,onSessionCreated}=_ref;//eslint-disable-next-line\nconst[token,setToken]=useState(localStorage.getItem(\"token\")||\"\");const[qrtoggle,setQrtoggle]=useState(false);const[qrData,setQrData]=useState(\"\");const[sessionDetails,setSessionDetails]=useState(null);// Handle Escape key to close modal\nuseEffect(()=>{const handleEscapeKey=e=>{if(e.key==='Escape'){handleClose();}};document.addEventListener('keydown',handleEscapeKey);// Focus the first input when modal opens\nsetTimeout(()=>{const firstInput=document.querySelector('.popup-inner input[name=\"name\"]');if(firstInput){firstInput.focus();}},100);return()=>{document.removeEventListener('keydown',handleEscapeKey);};},[]);// Prevent body scrolling when modal is open\nuseEffect(()=>{document.body.style.overflow='hidden';return()=>{document.body.style.overflow='unset';};},[]);const handleClose=()=>{setQrtoggle(false);setQrData(\"\");setSessionDetails(null);togglePopup();};const createQR=async e=>{e.preventDefault();// Show loading state\nconst submitBtn=e.target.querySelector('button[type=\"submit\"]');const originalText=submitBtn.textContent;submitBtn.textContent='⏳ Creating Session...';submitBtn.disabled=true;//create a 16 digit UUID\nconst uuid=()=>{return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c===\"x\"?r:r&0x3|0x8;return v.toString(16);});};let session_id=uuid();let name=e.target.name.value;let date=new Date();//get the date in the format yyyy-mm-dd\ndate=date.toISOString().split(\"T\")[0];let time=e.target.time.value;let duration=e.target.duration.value;let radius=e.target.radius.value;//get the current location\nlet location=\"\";if(navigator.geolocation){navigator.geolocation.getCurrentPosition(async position=>{const{latitude,longitude}=position.coords;const locationString=\"\".concat(latitude,\",\").concat(longitude);location=locationString.length>0?locationString:\"0,0\";if(name.length>0&&duration.length>0){const formData={token,session_id,date,time,name,duration,location,radius};try{const response=await axios.post(\"\".concat(API_BASE_URL,\"/sessions/create\"),formData);if(response.data&&response.data.url){setQrData(response.data.url);setSessionDetails({name,date,time,duration,radius});setQrtoggle(true);// Notify parent component that session was created with QR data\nif(onSessionCreated){onSessionCreated(response.data.url,{name,date,time,duration,radius});}}else{alert(\"Error: Invalid response from server\");submitBtn.textContent=originalText;submitBtn.disabled=false;}}catch(err){var _err$response,_err$response$data;console.error(\"Error creating session:\",err);if(err.response&&err.response.status===401){// Token expired or invalid, redirect to login\nlocalStorage.clear();window.location.href=\"/login\";return;}alert(\"Error creating session: \".concat(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||err.message));submitBtn.textContent=originalText;submitBtn.disabled=false;}}else{alert(\"Please fill all the fields\");submitBtn.textContent=originalText;submitBtn.disabled=false;}},error=>{console.error(\"Error getting geolocation:\",error);alert(\"Error getting location. Please enable location services.\");submitBtn.textContent=originalText;submitBtn.disabled=false;},{enableHighAccuracy:true,maximumAge:0});}else{alert(\"Geolocation is not supported by this browser.\");const submitBtn=e.target.querySelector('button[type=\"submit\"]');submitBtn.textContent='✨ Create Session & Generate QR';submitBtn.disabled=false;}};const copyQR=()=>{navigator.clipboard.writeText(qrData);alert(\"QR code URL copied to clipboard!\");};const handleOverlayClick=e=>{// Close modal when clicking on the overlay (not the content)\nif(e.target===e.currentTarget){handleClose();}};return/*#__PURE__*/_jsxs(\"div\",{className:\"new-popup\",onClick:handleOverlayClick,children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleClose,className:\"close-btn\",\"aria-label\":\"Close modal\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"\\u2715\"})}),!qrtoggle&&/*#__PURE__*/_jsxs(\"div\",{className:\"popup-inner\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"\\uD83D\\uDCCB Create a New Session\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:createQR,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"name\",placeholder:\"Session Name\",autoComplete:\"off\",required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"duration\",placeholder:\"Duration (e.g., 1 hour)\",autoComplete:\"off\",required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"time\",name:\"time\",placeholder:\"Time\",autoComplete:\"off\",required:true}),/*#__PURE__*/_jsxs(\"select\",{name:\"radius\",id:\"radius\",autoComplete:\"off\",required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select attendance radius\"}),/*#__PURE__*/_jsx(\"option\",{value:\"50\",children:\"50 meters\"}),/*#__PURE__*/_jsx(\"option\",{value:\"75\",children:\"75 meters\"}),/*#__PURE__*/_jsx(\"option\",{value:\"100\",children:\"100 meters\"}),/*#__PURE__*/_jsx(\"option\",{value:\"150\",children:\"150 meters\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"create-btn\",children:\"\\u2728 Create Session & Generate QR\"})]})]}),qrtoggle&&/*#__PURE__*/_jsxs(\"div\",{className:\"qr-code-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"qr-header\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"\\uD83C\\uDF89 Session Created Successfully!\"}),sessionDetails&&/*#__PURE__*/_jsxs(\"div\",{className:\"session-summary\",children:[/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsxs(\"strong\",{children:[\"\\uD83D\\uDCDA \",sessionDetails.name]})}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uD83D\\uDCC5 \",sessionDetails.date,\" \\u23F0 \",sessionDetails.time]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u23F1\\uFE0F \",sessionDetails.duration,\" \\uD83D\\uDCCD \",sessionDetails.radius,\"m radius\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"qr-display\",children:[/*#__PURE__*/_jsx(QRCode,{value:qrData,size:250,level:\"H\"}),/*#__PURE__*/_jsx(\"p\",{className:\"qr-instruction\",children:\"Students can scan this QR code to mark attendance\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"qr-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:copyQR,className:\"copy-btn\",children:\"\\uD83D\\uDCCB Copy QR Link\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleClose,className:\"done-btn\",children:\"\\u2705 Done\"})]})]})]});};export default NewSession;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}