{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import axios from\"axios\";import API_BASE_URL from\"../config/api\";import\"../styles/StudentDashboard.css\";import{useNavigate}from\"react-router-dom\";import StudentForm from\"./StudentForm\";import QRScanner from\"../components/QRScanner\";import SideNav from\"../components/SideNav\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const queryParameters=new URLSearchParams(window.location.search);const Dashboard=()=>{//eslint-disable-next-line\nconst[token,setToken]=useState(localStorage.getItem(\"token\")||\"\");// eslint-disable-next-line\nconst[sessionList,setSessionList]=useState([]);const[isSessionDisplay,setSessionDisplay]=useState(false);const[showQRScanner,setShowQRScanner]=useState(false);const[currentSessions,setCurrentSessions]=useState([]);const[showMobileNav,setShowMobileNav]=useState(false);const navigate=useNavigate();function handleCurrentSessionScan(sessionData){// Set session data and open scanner for current running session\nlocalStorage.setItem(\"session_id\",sessionData.session_id);localStorage.setItem(\"teacher_email\",sessionData.teacher_email);setShowQRScanner(true);}function getStudentSessions(){axios.post(\"\".concat(API_BASE_URL,\"/sessions/getStudentSessions\"),{token:token}).then(response=>{setSessionList(response.data.sessions);}).catch(error=>{console.log(error);if(error.response&&error.response.status===401){// Token expired or invalid, redirect to login\nlocalStorage.removeItem('token');navigate('/login');}});}function getCurrentSessions(){axios.post(\"\".concat(API_BASE_URL,\"/sessions/getCurrentSessions\"),{token:token}).then(response=>{setCurrentSessions(response.data.sessions||[]);}).catch(error=>{console.log(\"Error fetching current sessions:\",error);if(error.response&&error.response.status===401){// Token expired or invalid, redirect to login\nlocalStorage.removeItem('token');navigate('/login');}else{// If API doesn't exist or other error, show empty current sessions\nsetCurrentSessions([]);}});}function toggleStudentForm(action){if(action===\"open\"){setSessionDisplay(true);}else{localStorage.removeItem(\"session_id\");localStorage.removeItem(\"teacher_email\");setSessionDisplay(false);navigate(\"/student-dashboard\");}}function getDistance(distance,radius){return{distance,color:distance<=parseFloat(radius)?\"green\":\"red\"};}function handleQRScan(scannedData){try{// Parse the scanned QR data - expecting format: session_id=xxx&email=xxx\nconst url=new URL(scannedData);const sessionId=url.searchParams.get(\"session_id\");const teacherEmail=url.searchParams.get(\"email\");if(sessionId&&teacherEmail){localStorage.setItem(\"session_id\",sessionId);localStorage.setItem(\"teacher_email\",teacherEmail);setShowQRScanner(false);toggleStudentForm(\"open\");}else{alert(\"Invalid QR code. Please scan a valid attendance QR code.\");}}catch(error){// Try alternative parsing for different QR format\nif(scannedData.includes(\"session_id\")&&scannedData.includes(\"email\")){const params=new URLSearchParams(scannedData.split('?')[1]||scannedData);const sessionId=params.get(\"session_id\");const teacherEmail=params.get(\"email\");if(sessionId&&teacherEmail){localStorage.setItem(\"session_id\",sessionId);localStorage.setItem(\"teacher_email\",teacherEmail);setShowQRScanner(false);toggleStudentForm(\"open\");}else{alert(\"Invalid QR code format.\");}}else{alert(\"Invalid QR code. Please scan a valid attendance QR code.\");}}}useEffect(()=>{if(token===\"\"||token===undefined){navigate(\"/login\");}else{// Check if user is actually a student\nconst userType=localStorage.getItem(\"type\");if(userType===\"teacher\"){// If user is a teacher, redirect to teacher dashboard\nnavigate(\"/teacher-dashboard\");return;}getStudentSessions();getCurrentSessions();try{if(queryParameters.get(\"session_id\")!==null&&queryParameters.get(\"email\")!==null){localStorage.setItem(\"session_id\",queryParameters.get(\"session_id\"));localStorage.setItem(\"teacher_email\",queryParameters.get(\"email\"));}if(localStorage.getItem(\"session_id\")==null&&localStorage.getItem(\"teacher_email\")==null){toggleStudentForm(\"close\");}else{toggleStudentForm(\"open\");}}catch(err){console.log(err);}}},[token]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mobile-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mobile-header-content\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83D\\uDC68\\u200D\\uD83C\\uDF93 Student Dashboard\"}),/*#__PURE__*/_jsx(\"button\",{className:\"mobile-nav-toggle\",onClick:()=>setShowMobileNav(!showMobileNav),children:showMobileNav?'âœ•':'â˜°'})]}),showMobileNav&&/*#__PURE__*/_jsxs(\"div\",{className:\"mobile-nav-dropdown\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{navigate(\"/student-dashboard\");setShowMobileNav(false);},children:\"\\uD83C\\uDFE0 Dashboard\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{navigate(\"/reports\");setShowMobileNav(false);},children:\"\\uD83D\\uDCCA My Reports\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowQRScanner(true);setShowMobileNav(false);},children:\"\\uD83D\\uDCF1 Scan QR Code\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{navigate(\"/logout\");setShowMobileNav(false);},children:\"\\uD83D\\uDEAA Logout\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"app-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"desktop-nav\",children:/*#__PURE__*/_jsx(SideNav,{userType:\"student\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"main-content-area\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-main\",children:[!isSessionDisplay&&/*#__PURE__*/_jsxs(_Fragment,{children:[currentSessions.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"current-sessions\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCCD Currently Active Sessions\"}),/*#__PURE__*/_jsx(\"div\",{className:\"current-sessions-grid\",children:currentSessions.map((session,index)=>{var _session$date;return/*#__PURE__*/_jsxs(\"div\",{className:\"current-session-card \".concat(session.status||'active'),children:[/*#__PURE__*/_jsx(\"div\",{className:\"session-status-badge\",children:session.status==='starting_soon'?'ðŸ•’ Starting Soon':'ðŸŸ¢ Active Now'}),/*#__PURE__*/_jsxs(\"div\",{className:\"session-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:session.name}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uD83D\\uDCC5 \",(_session$date=session.date)===null||_session$date===void 0?void 0:_session$date.split(\"T\")[0]]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uD83D\\uDD52 \",session.time]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u23F1\\uFE0F Duration: \",session.duration||'60 min']}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uD83D\\uDCCD \",session.location]}),/*#__PURE__*/_jsxs(\"p\",{className:\"teacher-name\",children:[\"\\uD83D\\uDC68\\u200D\\uD83C\\uDFEB \",session.teacher_name]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"qr-section\",children:[session.qr_code&&/*#__PURE__*/_jsx(\"img\",{src:session.qr_code,alt:\"QR Code\",className:\"session-qr\"}),/*#__PURE__*/_jsx(\"button\",{className:\"scan-btn\",onClick:()=>handleCurrentSessionScan(session),children:\"\\uD83D\\uDCF1 Mark Attendance\"})]})]},\"current-\".concat(index));})})]}),currentSessions.length===0&&/*#__PURE__*/_jsxs(\"div\",{className:\"scan-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCF1 Mark Attendance\"}),/*#__PURE__*/_jsx(\"button\",{className:\"scan-qr-main-btn\",onClick:()=>setShowQRScanner(true),children:\"\\uD83D\\uDD0D Scan QR Code for Attendance\"}),/*#__PURE__*/_jsx(\"p\",{className:\"scan-instruction\",children:\"Ask your teacher to show the QR code for the current session\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"attendance-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCDA Recent Attendance\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"attendance-count\",children:[sessionList.length,\" sessions attended\"]})]}),sessionList.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"attendance-list\",children:[sessionList.slice(0,5).map((session,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"attendance-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"course-info\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"course-name\",children:session.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"session-meta\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"date\",children:[\"\\uD83D\\uDCC5 \",new Date(session.date).toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"span\",{className:\"time\",children:[\"\\u23F0 \",session.time]}),/*#__PURE__*/_jsxs(\"span\",{className:\"duration\",children:[\"\\u23F1\\uFE0F \",session.duration]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"attendance-status\",children:/*#__PURE__*/_jsx(\"span\",{className:\"status-badge \".concat(getDistance(session.distance,session.radius).color==='green'?'present':'late'),children:getDistance(session.distance,session.radius).color==='green'?'âœ… Present':'âš ï¸ Late'})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Distance:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"value distance-value \".concat(getDistance(session.distance,session.radius).color),children:[session.distance,\"m (Limit: \",session.radius,\"m)\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Photo:\"}),/*#__PURE__*/_jsx(\"img\",{src:session.image,alt:\"Attendance proof\",className:\"attendance-photo\",onClick:()=>window.open(session.image,'_blank')})]})]})]},index)),sessionList.length>5&&/*#__PURE__*/_jsx(\"div\",{className:\"view-all-container\",children:/*#__PURE__*/_jsxs(\"button\",{className:\"view-all-btn\",children:[\"View All \",sessionList.length,\" Sessions \\u2192\"]})})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"no-attendance\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"no-attendance-icon\",children:\"\\uD83D\\uDCCB\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"No attendance records yet\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Your attendance history will appear here once you start marking attendance\"})]})]})]}),/*#__PURE__*/_jsx(QRScanner,{isOpen:showQRScanner,onScan:handleQRScan,onClose:()=>setShowQRScanner(false)}),isSessionDisplay&&/*#__PURE__*/_jsx(\"div\",{className:\"popup-overlay\",children:/*#__PURE__*/_jsx(StudentForm,{togglePopup:toggleStudentForm})})]})})]})]});};export default Dashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}