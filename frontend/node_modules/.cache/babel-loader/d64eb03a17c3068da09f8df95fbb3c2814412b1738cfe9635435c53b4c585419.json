{"ast":null,"code":"import React,{useEffect,useState,useCallback}from\"react\";import axios from\"axios\";import API_BASE_URL from\"../config/api\";import QRCode from\"qrcode.react\";import\"../styles/Dashboard.css\";import{useNavigate}from\"react-router-dom\";import NewSession from\"./NewSession\";import SessionDetails from\"./SessionDetails\";import SideNav from\"../components/SideNav\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";axios.defaults.withCredentials=true;const TeacherDashboard=()=>{//eslint-disable-next-line\nconst[token,setToken]=useState(localStorage.getItem(\"token\")||\"\");const[sessionList,setSessionList]=useState([]);const[isOpen,setIsOpen]=useState(false);const[isSessionDisplay,setSessionDisplay]=useState(false);const[currentSession,setCurrentSession]=useState(\"\");const[loading,setLoading]=useState(true);const[latestQR,setLatestQR]=useState(\"\");const[latestSessionDetails,setLatestSessionDetails]=useState(null);const navigate=useNavigate();//update list of sessions\nconst updateList=useCallback(async()=>{try{setLoading(true);const response=await axios.post(\"\".concat(API_BASE_URL,\"/sessions/getSessions\"),{token:token});setSessionList(response.data.sessions||[]);}catch(err){console.error(\"Error fetching sessions:\",err);if(err.response&&err.response.status===401){// Token expired or invalid, redirect to login\nlocalStorage.clear();navigate(\"/login\");return;}setSessionList([]);}finally{setLoading(false);}},[token]);const toggleSessionDetails=e=>{//get the session details that has session_id = e\nsetCurrentSession(sessionList.filter(session=>{return session.session_id===e;}));setSessionDisplay(!isSessionDisplay);};const handleSessionCreated=(qrData,sessionDetails)=>{// Refresh the session list and store QR data\nupdateList();setLatestQR(qrData);setLatestSessionDetails(sessionDetails);};const togglePopup=()=>{setIsOpen(!isOpen);};const copyLatestQR=()=>{if(latestQR){navigator.clipboard.writeText(latestQR);alert(\"QR code URL copied to clipboard!\");}};useEffect(()=>{if(token===\"\"||token===undefined){navigate(\"/login\");}else{// Check if user is actually a teacher\nconst userType=localStorage.getItem(\"type\");if(userType!==\"teacher\"){// If user is not a teacher, redirect to appropriate dashboard\nnavigate(\"/student-dashboard\");return;}updateList();}},[token,navigate,updateList]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"app-container\",children:[/*#__PURE__*/_jsx(SideNav,{onCreateSession:togglePopup,userType:\"teacher\"}),/*#__PURE__*/_jsx(\"div\",{className:\"main-content-area\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-main\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"teacher-overview\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"overview-header\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83D\\uDC68\\u200D\\uD83C\\uDFEB Teacher Dashboard\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"teacher-stats\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card total-sessions\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-icon\",children:\"\\uD83D\\uDCDA\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:sessionList.length}),/*#__PURE__*/_jsx(\"p\",{children:\"Total Sessions\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card total-attendance\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-icon\",children:\"\\uD83D\\uDC65\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:sessionList.reduce((total,session)=>{var _session$attendance;return total+(((_session$attendance=session.attendance)===null||_session$attendance===void 0?void 0:_session$attendance.length)||0);},0)}),/*#__PURE__*/_jsx(\"p\",{children:\"Total Attendance\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card recent-sessions\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-icon\",children:\"\\uD83D\\uDD52\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:sessionList.filter(session=>{const sessionDate=new Date(session.date);const today=new Date();const diffTime=Math.abs(today-sessionDate);const diffDays=Math.ceil(diffTime/(1000*60*60*24));return diffDays<=7;}).length}),/*#__PURE__*/_jsx(\"p\",{children:\"This Week\"})]})]})]})]}),latestQR&&latestSessionDetails&&/*#__PURE__*/_jsxs(\"div\",{className:\"latest-session-qr\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83C\\uDF89 Latest Session Created\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setLatestQR(\"\");setLatestSessionDetails(null);},className:\"close-qr-btn\",children:\"\\u2715 Dismiss\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"qr-display-dashboard\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"session-summary-dashboard\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"\\uD83D\\uDCDA \",latestSessionDetails.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uD83D\\uDCC5 \",latestSessionDetails.date,\" \\u23F0 \",latestSessionDetails.time]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u23F1\\uFE0F \",latestSessionDetails.duration,\" \\uD83D\\uDCCD \",latestSessionDetails.radius,\"m radius\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"qr-container-dashboard\",children:[/*#__PURE__*/_jsx(QRCode,{value:latestQR,size:200,level:\"H\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Students can scan this QR code to mark attendance\"}),/*#__PURE__*/_jsx(\"button\",{onClick:copyLatestQR,className:\"copy-qr-dashboard-btn\",children:\"\\uD83D\\uDCCB Copy QR Link\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sessions-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCCA Recent Sessions & Attendance\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"session-count\",children:[sessionList.length,\" sessions created\"]})]}),loading?/*#__PURE__*/_jsxs(\"div\",{className:\"loading-state\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-icon\",children:\"\\u23F3\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading sessions...\"})]}):sessionList.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"teacher-sessions-list\",children:[sessionList.slice(0,5).map((session,index)=>{var _session$attendance2;return/*#__PURE__*/_jsxs(\"div\",{className:\"teacher-session-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"session-card-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"session-info\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"session-name\",children:session.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"session-meta\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"date\",children:[\"\\uD83D\\uDCC5 \",new Date(session.date).toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"span\",{className:\"time\",children:[\"\\u23F0 \",session.time]}),/*#__PURE__*/_jsxs(\"span\",{className:\"duration\",children:[\"\\u23F1\\uFE0F \",session.duration]}),/*#__PURE__*/_jsxs(\"span\",{className:\"location\",children:[\"\\uD83D\\uDCCD Radius: \",session.radius,\"m\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"attendance-summary\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"attendance-count-badge\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"count\",children:((_session$attendance2=session.attendance)===null||_session$attendance2===void 0?void 0:_session$attendance2.length)||0}),/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Students\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"session-card-body\",children:[session.attendance&&session.attendance.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"student-attendance-list\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83D\\uDC65 Student Attendance:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"student-list\",children:[session.attendance.slice(0,3).map((student,idx)=>/*#__PURE__*/_jsxs(\"div\",{className:\"student-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"student-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"student-email\",children:student.student_email}),/*#__PURE__*/_jsxs(\"span\",{className:\"student-distance\",children:[\"\\uD83D\\uDCCD \",student.distance,\"m\",/*#__PURE__*/_jsx(\"span\",{className:\"distance-status \".concat(parseFloat(student.distance)<=parseFloat(session.radius)?'on-time':'late'),children:parseFloat(student.distance)<=parseFloat(session.radius)?'✅':'⚠️'})]})]}),/*#__PURE__*/_jsx(\"img\",{src:student.image,alt:\"Student verification\",className:\"student-photo\",onClick:()=>window.open(student.image,'_blank')})]},idx)),session.attendance.length>3&&/*#__PURE__*/_jsxs(\"div\",{className:\"more-students\",children:[\"+\",session.attendance.length-3,\" more students\"]})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"no-attendance\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"no-attendance-icon\",children:\"\\uD83D\\uDC64\"}),/*#__PURE__*/_jsx(\"span\",{children:\"No students attended yet\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"session-actions\",children:/*#__PURE__*/_jsx(\"button\",{className:\"view-details-btn\",onClick:()=>toggleSessionDetails(session.session_id),children:\"\\uD83D\\uDCCB View Details\"})})]})]},index);}),sessionList.length>5&&/*#__PURE__*/_jsx(\"div\",{className:\"view-all-container\",children:/*#__PURE__*/_jsxs(\"button\",{className:\"view-all-sessions-btn\",children:[\"View All \",sessionList.length,\" Sessions \\u2192\"]})})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"no-sessions\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"no-sessions-icon\",children:\"\\uD83D\\uDCCB\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"No sessions created yet\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Click \\\"Create Session\\\" in the sidebar to get started\"})]})]})]})})]}),isSessionDisplay&&/*#__PURE__*/_jsx(\"div\",{className:\"popup-overlay\",children:/*#__PURE__*/_jsx(SessionDetails,{currentSession:currentSession,toggleSessionDetails:toggleSessionDetails})}),isOpen&&/*#__PURE__*/_jsx(\"div\",{className:\"popup-overlay\",children:/*#__PURE__*/_jsx(NewSession,{togglePopup:togglePopup,onSessionCreated:handleSessionCreated})})]});};export default TeacherDashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}