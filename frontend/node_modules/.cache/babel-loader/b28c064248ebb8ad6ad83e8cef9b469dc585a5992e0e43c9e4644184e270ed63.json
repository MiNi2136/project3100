{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{useNavigate}from\"react-router-dom\";import axios from\"axios\";import API_BASE_URL from\"../config/api\";import SideNav from\"../components/SideNav\";import\"../styles/TeacherReports.css\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const TeacherReports=()=>{const[token,setToken]=useState(localStorage.getItem(\"token\")||\"\");const[sessionList,setSessionList]=useState([]);const[loading,setLoading]=useState(true);const[selectedCourse,setSelectedCourse]=useState(\"all\");const[searchTerm,setSearchTerm]=useState(\"\");const[filterStatus,setFilterStatus]=useState(\"all\");const[viewMode,setViewMode]=useState(\"summary\");// summary, detailed, datasheet\nconst[editingCT,setEditingCT]=useState(null);// For inline CT marks editing\nconst[ctMarksInput,setCTMarksInput]=useState(\"\");const navigate=useNavigate();// Update CT marks for a student\nconst updateCTMarks=(sessionId,studentEmail,examType,marks)=>{const ctMarksData={[examType]:marks};axios.post(\"\".concat(API_BASE_URL,\"/sessions/updateCTMarks\"),{token:token,session_id:sessionId,student_email:studentEmail,ct_marks:ctMarksData}).then(()=>{// Refresh data after update\ngetTeacherAttendanceReports();setEditingCT(null);setCTMarksInput(\"\");}).catch(err=>{console.log(\"Error updating CT marks:\",err);alert(\"Failed to update CT marks\");});};// Get detailed teacher attendance reports\nfunction getTeacherAttendanceReports(){setLoading(true);axios.post(\"\".concat(API_BASE_URL,\"/sessions/getAttendanceReports\"),{token:token}).then(response=>{setSessionList(response.data.sessions||[]);setLoading(false);}).catch(err=>{console.log(\"Error fetching attendance reports:\",err);setSessionList([]);setLoading(false);});}// Get unique courses for filtering\nconst getUniqueCourses=()=>{const courses=sessionList.map(session=>session.name);return[...new Set(courses)];};// Calculate overall statistics\nconst calculateStats=()=>{const filteredData=getFilteredSessions();const totalSessions=filteredData.length;const totalStudents=filteredData.reduce((sum,session)=>sum+(session.total_students||0),0);const totalPresent=filteredData.reduce((sum,session)=>sum+(session.present_count||0),0);const totalLate=filteredData.reduce((sum,session)=>sum+(session.late_count||0),0);const attendanceRate=totalStudents>0?Math.round(totalPresent/totalStudents*100):0;return{totalSessions,totalStudents,totalPresent,totalLate,attendanceRate};};// Filter sessions based on search, course, and status\nconst getFilteredSessions=()=>{return sessionList.filter(session=>{const matchesSearch=session.name.toLowerCase().includes(searchTerm.toLowerCase());const matchesCourse=selectedCourse===\"all\"||session.name===selectedCourse;if(filterStatus===\"all\")return matchesSearch&&matchesCourse;const hasAttendance=session.attendance&&session.attendance.length>0;if(filterStatus===\"with-attendance\")return matchesSearch&&matchesCourse&&hasAttendance;if(filterStatus===\"no-attendance\")return matchesSearch&&matchesCourse&&!hasAttendance;return matchesSearch&&matchesCourse;});};// Export data as CSV (which can be opened in Excel or converted to PDF)\nconst exportToCSV=()=>{const filteredSessions=getFilteredSessions();const csvData=[];// Add header\ncsvData.push(['Course Name','Session Date','Session Time','Student Name','Registration No','Email','Attendance Status','Distance (m)','Attendance Time','CT Marks']);// Add data rows\nfilteredSessions.forEach(session=>{if(session.attendance&&session.attendance.length>0){session.attendance.forEach(student=>{csvData.push([session.name,new Date(session.date).toLocaleDateString(),session.time,student.student_name,student.student_regno,student.student_email,student.status,student.distance,student.attendance_time,JSON.stringify(student.ct_marks)]);});}});// Convert to CSV string\nconst csvContent=csvData.map(row=>row.map(field=>\"\\\"\".concat(field,\"\\\"\")).join(',')).join('\\n');// Download CSV file\nconst blob=new Blob([csvContent],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=\"attendance-report-\".concat(new Date().toISOString().slice(0,10),\".csv\");document.body.appendChild(link);link.click();document.body.removeChild(link);};const stats=calculateStats();const filteredSessions=getFilteredSessions();const uniqueCourses=getUniqueCourses();useEffect(()=>{if(token===\"\"||token===undefined){navigate(\"/login\");}else{getTeacherAttendanceReports();}},[token,navigate]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"app-container\",children:[/*#__PURE__*/_jsx(SideNav,{onCreateSession:()=>{},userType:\"teacher\"}),/*#__PURE__*/_jsx(\"div\",{className:\"main-content-area\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"teacher-reports-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"reports-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uFFFD Attendance Reports & Analytics\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"view-mode-toggle\",children:[/*#__PURE__*/_jsx(\"button\",{className:viewMode===\"summary\"?\"active\":\"\",onClick:()=>setViewMode(\"summary\"),children:\"\\uD83D\\uDCC8 Summary\"}),/*#__PURE__*/_jsx(\"button\",{className:viewMode===\"datasheet\"?\"active\":\"\",onClick:()=>setViewMode(\"datasheet\"),children:\"\\uD83D\\uDCCB Data Sheet\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"teacher-stats-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"teacher-stat-card sessions\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-icon\",children:\"\\uD83D\\uDCDA\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:stats.totalSessions}),/*#__PURE__*/_jsx(\"p\",{children:\"Total Sessions\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"teacher-stat-card students\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-icon\",children:\"\\uD83D\\uDC65\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:stats.totalStudents}),/*#__PURE__*/_jsx(\"p\",{children:\"Total Attendance\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"teacher-stat-card present\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-icon\",children:\"\\u2705\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:stats.totalPresent}),/*#__PURE__*/_jsx(\"p\",{children:\"Present\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"teacher-stat-card late\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-icon\",children:\"\\u26A0\\uFE0F\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:stats.totalLate}),/*#__PURE__*/_jsx(\"p\",{children:\"Late\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"teacher-stat-card rate\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-icon\",children:\"\\uD83D\\uDCCA\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-info\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[stats.attendanceRate,\"%\"]}),/*#__PURE__*/_jsx(\"p\",{children:\"Attendance Rate\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"teacher-controls\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"search-container\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\uD83D\\uDD0D Search sessions...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"search-input\"})}),/*#__PURE__*/_jsxs(\"select\",{value:selectedCourse,onChange:e=>setSelectedCourse(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Courses\"}),uniqueCourses.map((course,index)=>/*#__PURE__*/_jsx(\"option\",{value:course,children:course},index))]}),/*#__PURE__*/_jsxs(\"select\",{value:filterStatus,onChange:e=>setFilterStatus(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Sessions\"}),/*#__PURE__*/_jsx(\"option\",{value:\"with-attendance\",children:\"With Attendance\"}),/*#__PURE__*/_jsx(\"option\",{value:\"no-attendance\",children:\"No Attendance\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"export-btn primary\",onClick:exportToCSV,disabled:filteredSessions.length===0,children:\"\\uD83D\\uDCC4 Export PDF/Excel\"})]}),loading?/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading attendance reports...\"})]}):viewMode===\"datasheet\"?/*#__PURE__*/// Data Sheet View\n_jsxs(\"div\",{className:\"datasheet-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"datasheet-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCCB Attendance Data Sheet\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Showing \",filteredSessions.length,\" sessions with detailed attendance records\"]})]}),filteredSessions.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"datasheet-table-container\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"attendance-datasheet\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Course\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Session Date\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Time\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Student Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Reg No\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Email\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Distance\"}),/*#__PURE__*/_jsx(\"th\",{children:\"CT Marks\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Attendance Time\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:filteredSessions.map((session,sessionIndex)=>{if(!session.attendance||session.attendance.length===0){return/*#__PURE__*/_jsxs(\"tr\",{className:\"no-attendance-row\",children:[/*#__PURE__*/_jsx(\"td\",{children:session.name}),/*#__PURE__*/_jsx(\"td\",{children:new Date(session.date).toLocaleDateString()}),/*#__PURE__*/_jsx(\"td\",{children:session.time}),/*#__PURE__*/_jsx(\"td\",{colSpan:\"7\",className:\"no-data\",children:\"No attendance recorded\"})]},sessionIndex);}return session.attendance.map((student,studentIndex)=>/*#__PURE__*/_jsxs(\"tr\",{className:student.status==='Present'?'present-row':'late-row',children:[/*#__PURE__*/_jsx(\"td\",{children:session.name}),/*#__PURE__*/_jsx(\"td\",{children:new Date(session.date).toLocaleDateString()}),/*#__PURE__*/_jsx(\"td\",{children:session.time}),/*#__PURE__*/_jsx(\"td\",{children:student.student_name}),/*#__PURE__*/_jsx(\"td\",{children:student.student_regno}),/*#__PURE__*/_jsx(\"td\",{children:student.student_email}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"span\",{className:\"status-badge \".concat(student.status.toLowerCase()),children:[student.status==='Present'?'✅':'⚠️',\" \",student.status]})}),/*#__PURE__*/_jsxs(\"td\",{children:[student.distance,\"m\"]}),/*#__PURE__*/_jsx(\"td\",{children:editingCT===\"\".concat(sessionIndex,\"-\").concat(studentIndex)?/*#__PURE__*/_jsxs(\"div\",{className:\"ct-edit-form\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"CT1: 15\",value:ctMarksInput,onChange:e=>setCTMarksInput(e.target.value),className:\"ct-input\",onKeyPress:e=>{if(e.key==='Enter'){const[examType,marks]=ctMarksInput.split(':').map(s=>s.trim());if(examType&&marks){updateCTMarks(session.session_id,student.student_email,examType,marks);}}}}),/*#__PURE__*/_jsxs(\"div\",{className:\"ct-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"ct-save-btn\",onClick:()=>{const[examType,marks]=ctMarksInput.split(':').map(s=>s.trim());if(examType&&marks){updateCTMarks(session.session_id,student.student_email,examType,marks);}},children:\"\\u2705\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ct-cancel-btn\",onClick:()=>{setEditingCT(null);setCTMarksInput(\"\");},children:\"\\u274C\"})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"ct-marks-cell\",onClick:()=>{setEditingCT(\"\".concat(sessionIndex,\"-\").concat(studentIndex));setCTMarksInput(\"\");},children:Object.keys(student.ct_marks).length>0?/*#__PURE__*/_jsx(\"span\",{className:\"ct-marks\",children:Object.entries(student.ct_marks).map(_ref=>{let[exam,mark]=_ref;return/*#__PURE__*/_jsxs(\"span\",{className:\"ct-mark-item\",children:[exam,\": \",mark]},exam);})}):/*#__PURE__*/_jsx(\"span\",{className:\"no-marks\",children:\"Click to add CT marks\"})})}),/*#__PURE__*/_jsx(\"td\",{children:student.attendance_time})]},\"\".concat(sessionIndex,\"-\").concat(studentIndex)));})})]})}):/*#__PURE__*/_jsx(\"div\",{className:\"no-data-message\",children:/*#__PURE__*/_jsx(\"p\",{children:\"No attendance data available for the selected filters.\"})})]}):/*#__PURE__*/// Summary View (existing)\n_jsx(\"div\",{className:\"teacher-session-reports\",children:filteredSessions.length>0?filteredSessions.map((session,index)=>{return/*#__PURE__*/_jsxs(\"div\",{className:\"session-report-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"session-report-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"session-details\",children:[/*#__PURE__*/_jsx(\"h3\",{children:session.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"session-info-meta\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"date\",children:[\"\\uD83D\\uDCC5 \",new Date(session.date).toLocaleDateString('en-US',{weekday:'short',year:'numeric',month:'short',day:'numeric'})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"time\",children:[\"\\u23F0 \",session.time]}),/*#__PURE__*/_jsxs(\"span\",{className:\"duration\",children:[\"\\u23F1\\uFE0F \",session.duration]}),/*#__PURE__*/_jsxs(\"span\",{className:\"radius\",children:[\"\\uD83D\\uDCCD \",session.radius,\"m radius\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"session-stats\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"quick-stats\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"quick-stat\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"number\",children:session.total_students}),/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Total\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"quick-stat success\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"number\",children:session.present_count}),/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Present\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"quick-stat warning\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"number\",children:session.late_count}),/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Late\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"quick-stat rate\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"number\",children:[session.total_students>0?Math.round(session.present_count/session.total_students*100):0,\"%\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Rate\"})]})]})})]}),session.total_students>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"attendance-details\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83D\\uDC65 Student Attendance Details:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"student-attendance-grid\",children:session.attendance.map((student,studentIndex)=>{return/*#__PURE__*/_jsxs(\"div\",{className:\"student-attendance-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"student-profile\",children:[/*#__PURE__*/_jsx(\"img\",{src:student.image,alt:\"Student verification\",className:\"student-verification-photo\",onClick:()=>window.open(student.image,'_blank')}),/*#__PURE__*/_jsxs(\"div\",{className:\"student-details\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"student-name\",children:student.student_name}),/*#__PURE__*/_jsxs(\"span\",{className:\"student-regno\",children:[\"Reg: \",student.student_regno]}),/*#__PURE__*/_jsx(\"span\",{className:\"student-email\",children:student.student_email}),/*#__PURE__*/_jsxs(\"span\",{className:\"attendance-time\",children:[\"\\uD83D\\uDD52 \",student.attendance_time]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"attendance-metrics\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"distance-metric \".concat(student.status==='Present'?'success':'warning'),children:[\"\\uD83D\\uDCCD \",student.distance,\"m\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"status-badge \".concat(student.status.toLowerCase()),children:student.status==='Present'?'✅ Present':'⚠️ Late'}),Object.keys(student.ct_marks).length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"ct-marks-display\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"ct-label\",children:\"CT:\"}),Object.entries(student.ct_marks).map(_ref2=>{let[exam,mark]=_ref2;return/*#__PURE__*/_jsxs(\"span\",{className:\"ct-mark\",children:[exam,\": \",mark]},exam);})]})]})]},studentIndex);})})]})]},index);}):/*#__PURE__*/_jsxs(\"div\",{className:\"no-sessions-found\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"no-sessions-icon\",children:\"\\uD83D\\uDD0D\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"No sessions found\"}),/*#__PURE__*/_jsx(\"p\",{children:searchTerm?\"No sessions match \\\"\".concat(searchTerm,\"\\\"\"):\"No sessions \".concat(filterStatus==='all'?'':'with '+filterStatus.replace('-',' '),\" found\")})]})})]})})]})});};export default TeacherReports;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}