{"ast":null,"code":"import _objectSpread from\"F:/eduattend/Atendo-main/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from\"react\";import{useNavigate}from\"react-router-dom\";import axios from\"axios\";import API_BASE_URL from\"../config/api\";import SideNav from\"../components/SideNav\";import\"../styles/Performance.css\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Performance=()=>{const[token,setToken]=useState(localStorage.getItem(\"token\")||\"\");const[performanceData,setPerformanceData]=useState([]);const[sessions,setSessions]=useState([]);const[loading,setLoading]=useState(true);const[searchTerm,setSearchTerm]=useState(\"\");const[selectedSession,setSelectedSession]=useState(\"\");const[editingCT,setEditingCT]=useState({});const[showAddCTColumn,setShowAddCTColumn]=useState(false);const[newCTColumn,setNewCTColumn]=useState(\"\");const[saving,setSaving]=useState(false);const[saveMessage,setSaveMessage]=useState(\"\");const navigate=useNavigate();// Get teacher sessions and compile performance data\nfunction getPerformanceData(){setLoading(true);axios.post(\"\".concat(API_BASE_URL,\"/sessions/getPerformanceData\"),{token:token}).then(response=>{const data=response.data;setSessions(data.sessions||[]);// Transform backend data to frontend format\nconst transformedData=data.performance_data.map(student=>({regNo:student.regno,email:student.email,attendanceRecords:student.attendance_records.reduce((acc,record)=>{acc[record.session_id]={sessionName:record.session_name,date:record.date,status:record.status,distance:record.distance,image:record.image};return acc;},{}),ctMarks:student.ct_marks||{},// Load saved CT marks from backend\ntotalSessions:student.total_sessions,attendedSessions:student.sessions_attended,attendancePercentage:student.attendance_percentage,attendanceMarks:Math.round(student.attendance_percentage/100*10)// Calculate attendance marks out of 10\n}));setPerformanceData(transformedData);setLoading(false);}).catch(err=>{console.log(\"Error fetching performance data:\",err);if(err.response&&err.response.status===401){// Token expired or invalid, redirect to login\nlocalStorage.clear();window.location.href=\"/login\";return;}setPerformanceData([]);setLoading(false);});}// Add new CT marks column\nconst handleAddCTColumn=()=>{if(newCTColumn.trim()){setPerformanceData(prevData=>prevData.map(student=>_objectSpread(_objectSpread({},student),{},{ctMarks:_objectSpread(_objectSpread({},student.ctMarks),{},{[newCTColumn]:\"\"})})));setNewCTColumn(\"\");setShowAddCTColumn(false);}};// Update CT marks for a student\nconst handleCTMarksChange=(studentIndex,columnName,value)=>{setPerformanceData(prevData=>{const newData=[...prevData];newData[studentIndex].ctMarks[columnName]=value;return newData;});};// Save CT marks to backend\nconst saveCTMarks=async()=>{setSaving(true);setSaveMessage(\"Saving...\");try{const ctMarksData=performanceData.map(student=>({regno:student.regNo,email:student.email,ct_marks:student.ctMarks}));const response=await axios.post(\"\".concat(API_BASE_URL,\"/sessions/saveCTMarks\"),{token:token,ct_marks_data:ctMarksData});setSaveMessage(\"✅ CT Marks saved successfully!\");setTimeout(()=>setSaveMessage(\"\"),3000);}catch(error){console.error(\"Error saving CT marks:\",error);setSaveMessage(\"❌ Error saving CT marks. Please try again.\");setTimeout(()=>setSaveMessage(\"\"),3000);}setSaving(false);};// Handle Ctrl+S keyboard shortcut\nconst handleKeyDown=e=>{if(e.ctrlKey&&e.key==='s'){e.preventDefault();saveCTMarks();}};// Get unique CT columns\nconst getCTColumns=()=>{const columns=new Set();performanceData.forEach(student=>{Object.keys(student.ctMarks).forEach(column=>columns.add(column));});return Array.from(columns);};// Filter performance data based on search and session\nconst filteredData=performanceData.filter(student=>{const matchesSearch=student.regNo.toLowerCase().includes(searchTerm.toLowerCase())||student.email.toLowerCase().includes(searchTerm.toLowerCase());if(!selectedSession)return matchesSearch;return matchesSearch&&student.attendanceRecords[selectedSession];});// Export data to CSV\nconst exportToCSV=()=>{const ctColumns=getCTColumns();const headers=['Reg No','Email','Total Sessions','Attended','Attendance %','Attendance Marks (/10)',...ctColumns];const csvData=filteredData.map(student=>[student.regNo,student.email,student.totalSessions,student.attendedSessions,\"\".concat(student.attendancePercentage,\"%\"),\"\".concat(student.attendanceMarks,\"/10\"),...ctColumns.map(column=>student.ctMarks[column]||'')]);const csvContent=[headers,...csvData].map(row=>row.map(cell=>\"\\\"\".concat(cell,\"\\\"\")).join(',')).join('\\n');const blob=new Blob([csvContent],{type:'text/csv'});const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.setAttribute('hidden','');a.setAttribute('href',url);a.setAttribute('download',\"performance-report-\".concat(new Date().toISOString().split('T')[0],\".csv\"));document.body.appendChild(a);a.click();document.body.removeChild(a);};useEffect(()=>{if(token===\"\"||token===undefined){navigate(\"/login\");}else{// Check if user is actually a teacher\nconst userType=localStorage.getItem(\"type\");if(userType!==\"teacher\"){navigate(\"/student-dashboard\");return;}getPerformanceData();}// Add keyboard event listener for Ctrl+S\ndocument.addEventListener('keydown',handleKeyDown);return()=>{document.removeEventListener('keydown',handleKeyDown);};},[token,navigate]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"app-container\",children:[/*#__PURE__*/_jsx(SideNav,{onCreateSession:()=>{},userType:\"teacher\"}),/*#__PURE__*/_jsx(\"div\",{className:\"main-content-area\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"performance-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"performance-header\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83D\\uDCCA Student Performance Dashboard\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"performance-controls\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"search-filter-section\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search by Reg No or Email...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"search-input\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedSession,onChange:e=>setSelectedSession(e.target.value),className:\"session-filter\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Sessions\"}),sessions.map(session=>/*#__PURE__*/_jsxs(\"option\",{value:session.session_id,children:[session.name,\" - \",new Date(session.date).toLocaleDateString()]},session.session_id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"action-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowAddCTColumn(true),className:\"add-ct-btn\",children:\"\\u2795 Add CT Column\"}),/*#__PURE__*/_jsx(\"button\",{onClick:saveCTMarks,className:\"save-btn\",disabled:saving,children:saving?\"💾 Saving...\":\"💾 Save CT Marks\"})]})]}),saveMessage&&/*#__PURE__*/_jsxs(\"div\",{className:\"save-message\",children:[saveMessage,/*#__PURE__*/_jsx(\"div\",{className:\"save-hint\",children:\"\\uD83D\\uDCA1 Tip: Press Ctrl+S to save quickly!\"})]}),showAddCTColumn&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Add New CT Marks Column\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Column name (e.g., CT-1, Quiz-1, etc.)\",value:newCTColumn,onChange:e=>setNewCTColumn(e.target.value),className:\"ct-column-input\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleAddCTColumn,className:\"confirm-btn\",children:\"Add Column\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowAddCTColumn(false);setNewCTColumn(\"\");},className:\"cancel-btn\",children:\"Cancel\"})]})]})}),loading?/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading performance data...\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"performance-table-container\",children:filteredData.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"table-wrapper\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"performance-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"sticky-col\",children:\"Reg No\"}),/*#__PURE__*/_jsx(\"th\",{className:\"sticky-col-2\",children:\"Email\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Total Sessions\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Attended\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Attendance %\"}),/*#__PURE__*/_jsx(\"th\",{className:\"attendance-marks-header\",children:\"Attendance Marks (/10)\"}),getCTColumns().map(column=>/*#__PURE__*/_jsx(\"th\",{className:\"ct-column\",children:column},column)),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:filteredData.map((student,index)=>/*#__PURE__*/_jsxs(\"tr\",{className:\"student-row\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"sticky-col reg-no-cell\",children:student.regNo}),/*#__PURE__*/_jsx(\"td\",{className:\"sticky-col-2 email-cell\",children:student.email}),/*#__PURE__*/_jsx(\"td\",{className:\"sessions-count\",children:student.totalSessions}),/*#__PURE__*/_jsx(\"td\",{className:\"attended-count\",children:student.attendedSessions}),/*#__PURE__*/_jsxs(\"td\",{className:\"attendance-percentage \".concat(student.attendancePercentage>=75?'good-attendance':student.attendancePercentage>=50?'average-attendance':'poor-attendance'),children:[student.attendancePercentage,\"%\"]}),/*#__PURE__*/_jsxs(\"td\",{className:\"attendance-marks attendance-marks-cell \".concat(student.attendanceMarks>=8?'excellent-marks':student.attendanceMarks>=6?'good-marks':student.attendanceMarks>=4?'average-marks':'poor-marks'),children:[student.attendanceMarks,\"/10\"]}),getCTColumns().map(column=>/*#__PURE__*/_jsx(\"td\",{className:\"ct-marks-cell\",children:/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"0\",max:\"100\",value:student.ctMarks[column]||\"\",onChange:e=>handleCTMarksChange(index,column,e.target.value),className:\"ct-marks-input\",placeholder:\"0\"})},column)),/*#__PURE__*/_jsx(\"td\",{className:\"actions-cell\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>{// Show detailed attendance records\nconst records=Object.values(student.attendanceRecords);alert(\"Detailed Attendance for \".concat(student.regNo,\":\\n\\n\")+records.map(record=>\"\".concat(record.sessionName,\" (\").concat(new Date(record.date).toLocaleDateString(),\"): \").concat(record.status)).join('\\n'));},className:\"view-details-btn\",children:\"\\uD83D\\uDC41\\uFE0F View\"})})]},student.email))})]})}):/*#__PURE__*/_jsxs(\"div\",{className:\"no-data-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"no-data-icon\",children:\"\\uD83D\\uDCCA\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"No Performance Data Available\"}),/*#__PURE__*/_jsx(\"p\",{children:\"No students have attended any sessions yet or no sessions found.\"})]})}),!loading&&filteredData.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"performance-summary\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCC8 Summary Statistics\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-cards\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"summary-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"summary-icon\",children:\"\\uD83D\\uDC65\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-info\",children:[/*#__PURE__*/_jsx(\"h4\",{children:filteredData.length}),/*#__PURE__*/_jsx(\"p\",{children:\"Total Students\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"summary-icon\",children:\"\\uD83D\\uDCDA\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-info\",children:[/*#__PURE__*/_jsx(\"h4\",{children:sessions.length}),/*#__PURE__*/_jsx(\"p\",{children:\"Total Sessions\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"summary-icon\",children:\"\\u2705\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-info\",children:[/*#__PURE__*/_jsxs(\"h4\",{children:[filteredData.length>0?Math.round(filteredData.reduce((sum,student)=>sum+student.attendancePercentage,0)/filteredData.length):0,\"%\"]}),/*#__PURE__*/_jsx(\"p\",{children:\"Average Attendance\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"summary-icon\",children:\"\\uD83D\\uDCDD\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-info\",children:[/*#__PURE__*/_jsx(\"h4\",{children:getCTColumns().length}),/*#__PURE__*/_jsx(\"p\",{children:\"CT Assessments\"})]})]})]})]})]})})]})});};export default Performance;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}