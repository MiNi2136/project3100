{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{useNavigate}from\"react-router-dom\";import axios from\"axios\";import API_BASE_URL from\"../config/api\";import SideNav from\"../components/SideNav\";import\"../styles/TeacherReportsDataSheet.css\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const TeacherReportsDataSheet=()=>{const[token,setToken]=useState(localStorage.getItem(\"token\")||\"\");const[sessionList,setSessionList]=useState([]);const[loading,setLoading]=useState(true);const[selectedCourse,setSelectedCourse]=useState(\"all\");const[searchTerm,setSearchTerm]=useState(\"\");const[editingCT,setEditingCT]=useState(null);const[ctMarksInput,setCTMarksInput]=useState(\"\");const navigate=useNavigate();// Get detailed teacher attendance reports\nfunction getTeacherAttendanceReports(){setLoading(true);axios.post(\"\".concat(API_BASE_URL,\"/sessions/getAttendanceReports\"),{token:token}).then(response=>{setSessionList(response.data.sessions||[]);setLoading(false);}).catch(err=>{console.log(\"Error fetching attendance reports:\",err);if(err.response&&err.response.status===401){localStorage.removeItem(\"token\");navigate(\"/login\");}setSessionList([]);setLoading(false);});}// Get unique courses for filtering\nconst getUniqueCourses=()=>{const courses=sessionList.map(session=>session.name);return[...new Set(courses)];};// Filter sessions based on search and course\nconst getFilteredSessions=()=>{return sessionList.filter(session=>{const matchesSearch=session.name.toLowerCase().includes(searchTerm.toLowerCase());const matchesCourse=selectedCourse===\"all\"||session.name===selectedCourse;const hasAttendance=session.attendance&&session.attendance.length>0;return matchesSearch&&matchesCourse&&hasAttendance;});};// Update CT marks for a student\nconst updateCTMarks=(sessionId,studentEmail,examType,marks)=>{const ctMarksData={[examType]:marks};axios.post(\"\".concat(API_BASE_URL,\"/sessions/updateCTMarks\"),{token:token,session_id:sessionId,student_email:studentEmail,ct_marks:ctMarksData}).then(()=>{getTeacherAttendanceReports();setEditingCT(null);setCTMarksInput(\"\");}).catch(err=>{console.log(\"Error updating CT marks:\",err);alert(\"Failed to update CT marks\");});};// Export data as CSV\nconst exportToPDF=()=>{const filteredSessions=getFilteredSessions();const csvData=[];// Add header\ncsvData.push(['Course Name','Session Date','Session Time','Student Name','Registration No','Email','Attendance Status','Distance (m)','Attendance Time','CT Marks']);// Add data rows\nfilteredSessions.forEach(session=>{session.attendance.forEach(student=>{const ctMarksStr=Object.entries(student.ct_marks).map(_ref=>{let[exam,mark]=_ref;return\"\".concat(exam,\": \").concat(mark);}).join('; ')||'Not assigned';csvData.push([session.name,new Date(session.date).toLocaleDateString(),session.time,student.student_name,student.student_regno,student.student_email,student.status,student.distance,student.attendance_time,ctMarksStr]);});});// Convert to CSV string\nconst csvContent=csvData.map(row=>row.map(field=>\"\\\"\".concat(field,\"\\\"\")).join(',')).join('\\n');// Download CSV file\nconst blob=new Blob([csvContent],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=\"attendance-reports-\".concat(new Date().toISOString().slice(0,10),\".csv\");document.body.appendChild(link);link.click();document.body.removeChild(link);};const filteredSessions=getFilteredSessions();const uniqueCourses=getUniqueCourses();// Calculate summary statistics\nconst totalStudents=filteredSessions.reduce((sum,session)=>sum+session.attendance.length,0);const totalPresent=filteredSessions.reduce((sum,session)=>sum+session.present_count,0);const totalLate=filteredSessions.reduce((sum,session)=>sum+session.late_count,0);useEffect(()=>{if(token===\"\"||token===undefined){navigate(\"/login\");}else{getTeacherAttendanceReports();}},[token,navigate]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"app-container\",children:[/*#__PURE__*/_jsx(SideNav,{onCreateSession:()=>{},userType:\"teacher\"}),/*#__PURE__*/_jsx(\"div\",{className:\"main-content-area\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"reports-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"reports-header\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83D\\uDCCB Attendance Reports\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"reports-controls\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filters\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search courses...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"search-input\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedCourse,onChange:e=>setSelectedCourse(e.target.value),className:\"course-filter\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Courses\"}),uniqueCourses.map((course,index)=>/*#__PURE__*/_jsx(\"option\",{value:course,children:course},index))]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"export-btn\",onClick:exportToPDF,disabled:filteredSessions.length===0,children:\"\\uD83D\\uDCC4 Export as PDF\"})]}),loading?/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading reports...\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"datasheet-container\",children:filteredSessions.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"table-container\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"reports-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Course\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Time\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Student Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Reg No\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Email\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Distance\"}),/*#__PURE__*/_jsx(\"th\",{children:\"CT Marks\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Attendance Time\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:filteredSessions.map((session,sessionIndex)=>session.attendance.map((student,studentIndex)=>/*#__PURE__*/_jsxs(\"tr\",{className:student.status==='Present'?'present-row':'late-row',children:[/*#__PURE__*/_jsx(\"td\",{className:\"course-cell\",children:session.name}),/*#__PURE__*/_jsx(\"td\",{children:new Date(session.date).toLocaleDateString()}),/*#__PURE__*/_jsx(\"td\",{children:session.time}),/*#__PURE__*/_jsx(\"td\",{className:\"student-name-cell\",children:student.student_name}),/*#__PURE__*/_jsx(\"td\",{className:\"regno-cell\",children:student.student_regno}),/*#__PURE__*/_jsx(\"td\",{className:\"email-cell\",children:student.student_email}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"status-badge \".concat(student.status.toLowerCase()),children:student.status})}),/*#__PURE__*/_jsxs(\"td\",{children:[student.distance,\"m\"]}),/*#__PURE__*/_jsx(\"td\",{className:\"ct-marks-cell\",children:editingCT===\"\".concat(sessionIndex,\"-\").concat(studentIndex)?/*#__PURE__*/_jsxs(\"div\",{className:\"ct-edit-form\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"CT1: 15\",value:ctMarksInput,onChange:e=>setCTMarksInput(e.target.value),className:\"ct-input\",onKeyPress:e=>{if(e.key==='Enter'){const[examType,marks]=ctMarksInput.split(':').map(s=>s.trim());if(examType&&marks){updateCTMarks(session.session_id,student.student_email,examType,marks);}}}}),/*#__PURE__*/_jsxs(\"div\",{className:\"ct-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"ct-save-btn\",onClick:()=>{const[examType,marks]=ctMarksInput.split(':').map(s=>s.trim());if(examType&&marks){updateCTMarks(session.session_id,student.student_email,examType,marks);}},children:\"\\u2705\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ct-cancel-btn\",onClick:()=>{setEditingCT(null);setCTMarksInput(\"\");},children:\"\\u274C\"})]})]}):/*#__PURE__*/_jsx(\"div\",{onClick:()=>{setEditingCT(\"\".concat(sessionIndex,\"-\").concat(studentIndex));setCTMarksInput(\"\");},children:Object.keys(student.ct_marks).length>0?/*#__PURE__*/_jsx(\"div\",{className:\"ct-marks-display\",children:Object.entries(student.ct_marks).map(_ref2=>{let[exam,mark]=_ref2;return/*#__PURE__*/_jsxs(\"span\",{className:\"ct-mark-item\",children:[exam,\": \",mark]},exam);})}):/*#__PURE__*/_jsx(\"span\",{className:\"add-ct-marks\",children:\"Click to add\"})})}),/*#__PURE__*/_jsx(\"td\",{children:student.attendance_time})]},\"\".concat(sessionIndex,\"-\").concat(studentIndex))))})]})}):/*#__PURE__*/_jsxs(\"div\",{className:\"no-data-message\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"no-data-icon\",children:\"\\uD83D\\uDCCA\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"No attendance data found\"}),/*#__PURE__*/_jsx(\"p\",{children:\"No attendance records available for the selected filters.\"})]})})]})})]})});};export default TeacherReportsDataSheet;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}